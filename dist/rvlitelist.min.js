/*! litelist 16-05-2014 */

!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.RivetsLiteList=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a){this.viewBuffer=new d,this.itemWidth=a.itemWidth||0,this.itemHeight=a.itemHeight,this.margin=a.margin||{x:0,y:0},this.dataSource=a.dataSource||!1,this.itemTemplate=a.itemTemplate||!1,this.scrollTop=0,this.dirtyResize=!0,this.ticking=!1,this.clientHeight=0,this.clientWidth=0,this.rowsPerPage=0,this.itemsPerRow=0,this.itemsPerPage=0,this.maxBuffer=0,this.height=0,this.view=a.scrollView,this.itemsContainer=a.itemsContainer||!1,this.view="string"==typeof this.view||this.view instanceof String?document.querySelector(this.view):this.view,this.itemsContainer="string"==typeof this.itemsContainer||this.itemsContainer instanceof String?document.querySelector(a.itemsContainer):this.itemsContainer,this._id=0,this.itemsContainer||(this.itemsContainer=this.view.children[0]),this._updateView=this._updateView.bind(this),this._scrollHandler=this._scrollHandler.bind(this),this._resizeHandler=this._resizeHandler.bind(this),this._calcViewMetrics(),a.delayBind||this.bind(),this.scroll=c.Scroll?new c.Scroll(a.scrollView,this._scrollHandler):!1,this._calcDocHeight(),this._requestTick()}var d=a("./viewbuffer");c.prototype._calcViewMetrics=function(){this.clientHeight=this.view.clientHeight,this.clientWidth=this.view.clientWidth,this.rowsPerPage=Math.ceil(this.clientHeight/(this.itemHeight+this.margin.y)),this.itemsPerRow=this.itemWidth?Math.floor(this.clientWidth/(this.itemWidth+this.margin.x)):1,this.itemsPerPage=this.rowsPerPage*this.itemsPerRow,this.maxBuffer=3*this.itemsPerPage},c.prototype._calcDocHeight=function(){var a=Math.ceil(this.viewBuffer.data.length/this.itemsPerRow),b=a*this.itemHeight+a*this.margin.y;return b!==this.height&&(this.itemsContainer.style.height=b+"px",this.height=b),this.height},c.prototype._initInViewItem=function(a){if(a.id=this._id++,this.itemTemplate){var b=this.itemTemplate.cloneNode(!0);b instanceof window.DocumentFragment&&(b=b.childNodes[0]),this.itemsContainer.appendChild(b),a.el=b,this.dataSource&&this.dataSource.bind&&this.dataSource.bind(a.id,b)}return a},c.prototype._syncViewItem=function(a){this.dataSource&&this.dataSource.sync&&this.dataSource.sync(a.id,a.el,a.idx,a.data)},c.prototype._positionViewItem=function(a,b){var c=a.idx,d=Math.floor(c/this.itemsPerRow),e=c%this.itemsPerRow,f=d*this.itemHeight+d*this.margin.y,g=e*this.itemWidth+e*this.margin.x;(b||a.top!==f)&&(a.top=f,a.el&&(a.el.style.top=f+"px")),(b||a.left!==g)&&(a.left=g,a.el&&(a.el.style.left=g+"px"))},c.prototype._ensureVisible=function(a){var b,c,d,e,f,g,h=this.scrollTop/this.height,i=(this.scrollTop+this.clientHeight)/this.height;if(this.direction<0)for(d=this.viewBuffer.view[this.viewBuffer.tail].idx,e=Math.ceil(i*this.viewBuffer.data.length),f=d;f>e+this.itemsPerRow;--f)g=this.viewBuffer.shift(-1)[0],g&&(this._syncViewItem(g),this._positionViewItem(g));else if(this.direction>0)for(b=this.viewBuffer.view[this.viewBuffer.head].idx,c=Math.floor(h*this.viewBuffer.data.length),f=b;f<c-this.itemsPerRow;++f)g=this.viewBuffer.shift(1)[0],g&&(this._syncViewItem(g),this._positionViewItem(g));a()},c.prototype._resize=function(a){var b,c=this.view.clientHeight,d=this.view.clientWidth,e=Math.ceil(c/(this.itemHeight+this.margin.y)),f=this.itemWidth?Math.floor(d/(this.itemWidth+this.margin.x)):1;if(e!==this.rowsPerPage||f!==this.itemsPerRow){this._calcViewMetrics(),this._calcDocHeight();var g=this._firstVisibleItem/this.viewBuffer.data.length;this.scrollTop=this.view.scrollTop=Math.floor(this.height*g);var h=Math.floor(this.scrollTop/(this.itemHeight+this.margin.y))*f;this.viewBuffer.view.length>this.maxBuffer?(b=this.viewBuffer.resize(this.maxBuffer),this.dataSource&&this.dataSource.unbind&&b.forEach(function(a){this.dataSource.unbind(a.id,a.el),this.itemsContainer.removeChild(a.el)},this)):this.viewBuffer.view.length<this.maxBuffer&&this.viewBuffer.resize(Math.min(this.maxBuffer,this.viewBuffer.data.length)).forEach(function(a){this._initInViewItem(a)},this);var i=h-this.viewBuffer.view[this.viewBuffer.head].idx-f;this.viewBuffer.shift(i),this.viewBuffer.view.forEach(function(a){this._positionViewItem(a)},this)}a()},c.prototype._updateView=function(){var a=function(){this._firstVisibleItem=Math.floor(this.scrollTop/(this.itemHeight+this.margin.y))*this.itemsPerRow,this._lastVisibleItem=Math.ceil((this.scrollTop+this.clientHeight)/(this.itemHeight+this.margin.y))*this.itemsPerRow,this.dirtyResize=!1,this.ticking=!1,this.direction=0}.bind(this);this.dirtyResize?this._resize(a):this._ensureVisible(a)},c.prototype._requestTick=function(){this.ticking||(this.ticking=!0,window.requestAnimationFrame(this._updateView))},c.prototype.push=function(){var a=Array.prototype.slice.call(arguments);this.viewBuffer.data.push.apply(this.viewBuffer.data,a);var b=this.viewBuffer.resize(Math.min(this.maxBuffer,this.viewBuffer.data.length));b.forEach(function(a){this._initInViewItem(a),this._syncViewItem(a),this._positionViewItem(a,!0)},this),this._calcDocHeight(),this._requestTick()},c.prototype.bind=function(){this.view.addEventListener("scroll",this._scrollHandler),window.addEventListener("resize",this._resizeHandler)},c.prototype.unbind=function(){this.view.removeEventListener("scroll",this._scrollHandler),window.removeEventListener("resize",this._resizeHandler),this.scroll&&this.scroll.unbind()},c.prototype.clear=function(){var a=this.dataSource&&this.dataSource.unbind;this.view.scrollTop=this.scrollTop=0;var b=this.viewBuffer.clear();this.itemTemplate&&b.forEach(function(b){b.el&&this.itemsContainer.removeChild(b.el),a&&this.dataSource.unbind(b.id,b.el)}.bind(this)),this._calcDocHeight()},c.prototype.forEach=function(){return this.items.forEach.apply(this.items,arguments)},c.prototype.forEachInView=function(){this.viewBuffer.forEachInView.apply(this.viewBuffer,arguments)},c.prototype.remove=function(a){var b=this.viewBuffer.remove(a);b.newInView.forEach(function(a){this._initInViewItem(a),this._syncViewItem(a),this._positionViewItem(a)},this),(this.itemTemplate||this.dataSource)&&b.removed.forEach(function(a){this.dataSource&&this.dataSource.unbind&&this.datasource.unbind(a.id,a.el),this.itemTemplate&&this.itemsContainer.removeChild(a.el)},this),b.updated.forEach(function(a){this._positionViewItem(a)},this),this._calcDocHeight()},c.prototype._scrollHandler=function(){var a=this.view.scrollTop;a!==this.scrollTop&&(this.direction=a>this.scrollTop?1:-1,this.scrollTop=a,this._requestTick())},c.prototype._resizeHandler=function(){this.dirtyResize=!0,this._requestTick()},c.VERSION="0.4.1",b.exports=c},{"./viewbuffer":3}],2:[function(a,b){function c(a){var b=a.delayBind,c={};Object.keys(a).forEach(function(b){c[b]=a[b]}),c.delayBind=!0,e.call(this,c),this.rivetsModels=c.rivetsModels||{},this.rivetsOpts=c.rivetsOpts||{},this.rivetsModels.items=this.viewBuffer.view,this.rivetsModels.metrics=this.liteList,this.rivetsOpts.binders=this.rivetsOpts.binders||{},this.rivetsOpts.binders.top=this.rivetsOpts.binders.top||function(a,b){a.style.top=b+"px"},this.rivetsOpts.binders.left=this.rivetsOpts.binders.left||function(a,b){a.style.left=b+"px"},this.rivetsOpts.binders.height=this.rivetsOpts.binders.height||function(a,b){a.style.height=b+"px"},b||this.bind()}var d,e=a("./litelist");"undefined"==typeof window&&(window={}),d=window.rivets||a("rivets"),c.prototype=Object.create(e.prototype),c.prototype.constructor=c,c.prototype.unbind=function(){this.rvView&&(this.rvView.unbind(),this.rvView=!1),e.prototype.unbind.call(this)},c.prototype.bind=function(){this.rvView=d.bind(this.view,this.rivetsModels,this.rivetsOpts),e.prototype.bind.call(this)},b.exports=c},{"./litelist":1,rivets:"4ZwREV"}],3:[function(a,b){"use strict";function c(a,b){this.head=this.tail=-1,this.size=0,this.data=a||[],this.view=[],b&&this.resize(b)}function d(a,b){var c,d=[],e=this.view,f=e.length-a;if(a>=e.length)throw new Error("Unable to shrink to a size larger than the current size");for(;f&&e.length>0;)c=e.splice(b?this.head:this.tail,1),d.push(c[0]),b?(this.head=this.head%e.length,this.tail=(this.head+1)%e.length):this.tail<this.head?(this.tail=this.tail-1,this.head=this.head-1,this.tail<0&&(this.tail=e.length-1)):this.tail>this.head?this.tail=this.tail-1:this.head=this.tail=-1,--f;return 0===e.length&&(this.head=this.tail=-1),this.size=e.length,d}function e(a,b){var c,d=[],e=this.view,f=this.data,g=a-e.length;if(a>f.length)throw new Error("Unable to grow to a size larger than the current dataset");if(0>g)throw new Error("Unable to grow to a size smaller than the current size");if(0===g)return d;for(;g;){if(-1===this.head&&-1===this.tail)c={idx:0,data:f[0]},e.push(c),this.head=this.tail=0;else if(b&&e[this.head].idx>0)c={idx:e[this.head].idx-1,data:f[e[this.head].idx-1]},e.splice(this.head,0,c),this.tail=(this.head-1+e.length)%e.length;else if(e[this.tail].idx<f.length-1)c={idx:e[this.tail].idx+1,data:f[e[this.tail].idx+1]},e.splice(this.tail+1,0,c),this.tail=this.tail+1,this.head=(this.tail+1)%e.length,c.idx===f.length-1&&(b=!0);else if(e[this.tail].idx===f.length-1){b=!0;continue}c&&d.push(c),c=!1,--g}return this.size=e.length,d}function f(a){var b,c=this.view,d=[],e=this.tail,f=this.head;for(a=a||1;a;){if(b=c[e].idx,b===this.data.length-1)return this.tail=e,this.head=f,d;e=(e+1)%c.length,f=(f+1)%c.length,c[e].idx=b+1,c[e].data=this.data[b+1],d.push(c[e]),d.length>c.length&&d.shift(),--a}return this.tail=e,this.head=f,d}function g(a){var b,c=this.view,d=[],e=this.head,f=this.tail,g=this.data;for(a=a||1;a;){if(b=c[e].idx,0===b)return this.head=e,this.tail=f,d;e=(e-1+c.length)%c.length,f=(f-1+c.length)%c.length,c[e].idx=b-1,c[e].data=g[b-1],d.push(c[e]),d.length>c.length&&d.shift(),--a}return this.head=e,this.tail=f,d}c.prototype.shift=function(a){var b;return a=a||1,b=a>0?f:g,b.call(this,Math.abs(a))},c.prototype.resize=function(a,b){return a>this.view.length?e.call(this,a,b):a<this.view.length?d.call(this,a,b):[]},c.prototype.clear=function(){var a=this.view.slice(0);return this.view.splice(0,Number.MAX_VALUE),this.data.splice(0,Number.MAX_VALUE),this.head=this.tail=-1,this.size=0,a},c.prototype.findDataIndexInView=function(a){for(var b=this.view,c=b.length,d=0;c>d;++d)if(b[d].idx===a)return d;return-1},c.prototype.remove=function(a){var b,c,d,e,f,g,h=this.head,i=this.tail,j=this.view,k=this.data,l=!1,m={newInView:[],removed:[],updated:[]};if(a=+a,a>=this.data.length)throw new Error("index out of bounds");if(this.data.splice(a,1),a>this.view[this.tail].idx)return m;if(a<j[h].idx)return j.forEach(function(a){a.idx=a.idx-1,m.updated.push(a)}),m;for(c=b=this.findDataIndexInView(a),b===h?0===h?d=this.tail=i-1:h===j.length-1?(this.head=0,l=!0,d=i):d=i+j.length-1:b===i?i===j.length-1?d=this.tail=i-1:0===i?(this.tail=j.length-2,this.head=0,d=-1):(d=this.tail=this.tail-1,this.head=h-1):h>b&&i>b?(d=this.tail=i-1,this.head=h-1):b>h&&i>b?d=this.tail=i-1:b>h&&b>i&&(d=i+j.length-1),this.size=this.size-1,f=j.splice(b,1),b=l?0:b,g=b;d>=g;++g)--j[g%j.length].idx,m.updated.push(j[g%j.length]);return k.length>j.length&&(e=this.resize(j.length+1)),m.removed.push.apply(m.removed,f),m.newInView.push.apply(m.newInView,e),m},c.prototype.forEachInView=function(a,b){var c,d,e,f=this.view,g=f.length,h=this.head,i=this.tail,j=h>i?i+g:i;for(b=b||this,c=h;j>=c;++c)e=c%g,d=f[e],a.call(b,d,c-h,e,f)},b.exports=c},{}]},{},[2])(2)});
//# sourceMappingURL=rvlitelist.min.map